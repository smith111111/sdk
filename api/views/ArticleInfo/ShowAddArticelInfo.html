<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../../static/js/jquery.js" type="text/javascript"></script>
    <script src="../../static/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="../../static/js/MyAjaxForm.js" type="text/javascript"></script>

    <script src="../../static/js/Ckeditor/ckeditor.js"></script>
    <link href="../../static/css/tableStyle.css" rel="stylesheet" />
    <style type="text/css">
        textarea, select {
            padding: 2px;
            border: 1px solid;
            border-color: #666 #ccc #ccc #666;
            background: #F9F9F9;
            color: #333;
            resize: none;
            width: 100%;
        }

        .textbox {
            padding: 3px;
            border: 1px solid;
            border-color: #666 #ccc #ccc #666;
            background: #F9F9F9;
            color: #333;
            resize: none;
            width: 100%;
        }

        .textbox:hover, .textbox:focus, textarea:hover, textarea:focus {
            border-color: #09C;
            background: #F5F9FD;
        }
    </style>

    <script>
        $(function () {
            $(".authorClick").click(function () {
                $("#Author").val($(this).text());
            })
            $(".originInfo").click(function () {
                $("#Origin").val($(this).text())
            })
            bindFileUp()
        })
        function bindFileUp() {
            $("#btnFileUp").click(function () {
                $("#form1").ajaxSubmit({
                    success: function (data) {
                        if (data.flag == "ok") {
                            //显示在下拉框
                            var imgurl=data.msg.substr(1)
                            $("#showImage").html("<img src='" + imgurl + "' width='50px' height='50px'/>");
                            $("#PhotoUrl").val(imgurl);

                            //判断是否选择了"图片是否插入编辑器"
                            var flag = $("#InsertEditContent").is(":checked");
                            if (flag) {
                                var oEditor = CKEDITOR.instances.ArticleContent2;//找到编辑器
                                if (oEditor.mode == 'wysiwyg') {//what you see is what you get  所见即所得
                                    var img = "<img src='"+imgurl+"'/>";
                                    oEditor.insertHtml(img);//将上传成功的图片插入到编辑器中。
                                }
                                else
                                    alert('You must be in WYSIWYG mode!');

                            }
                        }
                    },
                    error: function (error) { alert(error); },
                    url: '/Admin/ArticeInfo/FileUp', /*设置post提交到的页面*/
                    type: "post", /*设置表单以post方法提交*/
                    dataType: "json" /*设置返回值类型为文本*/
                });

            });
        }
        function subForm(){
            //获取编辑器内容。//这里很重要不要去用失去焦点,这里提交时获取
            var oEditor = CKEDITOR.instances.ArticleContent2;//找到编辑器
            var content = oEditor.getData();//获取编辑器中的数据
            $("#txtArticleContent").val(content);//将获取到的值插入到txtArticleContent整个文本域中
            // console.log($("#txtArticleContent").val())
            $('#form1').submit()
        }
        function afterAdd(data) {
            window.parent.closeAddArtice(data)
        }
    </script>
</head>
<body>
<div>
    <form  data-ajax="true" data-ajax-method="post" data-ajax-success="afterAdd" data-ajax-url="/Admin/ArticeInfo/AddArtice" id="form1">
        <table style="width:auto; margin: 0 auto">
            <tr>
                <td>简短标题:</td>
                <td>
                    <input type="text" name="title" maxlength="160" class="textbox" id="title" /></td>
            </tr>
            <tr>
                <td>完整标题:</td>
                <td colspan="4">
                    <input type="text" name="Fulltitle" class="textbox" id="Fulltitle" /></td>
            </tr>
            <tr>
                <td>归属栏目:</td>
                <td colspan="4">
                {{range .articelClass}}
                    <input type="radio" value="{{.Id}}" name="className">{{.ClassName}}
                {{end}}
                </td>
            </tr>
            <tr>
                <td>关 键 字</td>
                <td colspan="4">
                    <input type="text" name="KeyWords" class="textbox" id="KeyWords" /></td>
            </tr>
            <tr>
                <td>文章作者:</td>
                <td colspan="4">
                    <input type="text" name="Author" class="textbox" id="Author" />&nbsp;&nbsp;【<a href="#" class="authorClick">未知</a>】【<a href="#" class="authorClick">佚名</a>】【<a href="#" class="authorClick">Itcast</a>】</td>
            </tr>
            <tr>
                <td>文章来源:</td>
                <td colspan="4">
                    <input name="Origin" id="Origin"  value="" size="50" class="textbox" type="text">&nbsp;&nbsp;【<a href="#" class="originInfo">不详</a>】【<a href="#" class="originInfo">本站原创</a>】【<a href="#" class="originInfo">互联网</a>】</td>
            </tr>
            <tr>
                <td>文章导读</td>
                <td colspan="4">
                    <textarea class="textbox" name="Intro" style="width: 95%; height: 80px"></textarea></td>
            </tr>
            <tr>
                <td>文章内容</td>
                <td colspan="4">
                    <textarea class="ckeditor" onblur="getData2()" id="ArticleContent2" name="ArticleContent1" rows="30" cols="40" style="width: 95%; height: 80px"></textarea>
                    <script type="text/javascript">
                        //<![CDATA[
                        // Replace the <textarea id="editor1"> with an CKEditor instance.
                        var editor = CKEDITOR.replace('ArticleContent2');
                        //]]>
                    </script>
                    <textarea class="textbox"  name="ArticleContent" id="txtArticleContent" rows="30" cols="40" style="display:none"></textarea>
                </td>
            </tr>
            <tr>
                <td>图片地址:</td>
                <td colspan="4">
                    <input type="file" name="fileUp" />
                    <input type="button" value="上传图片" id="btnFileUp" />
                    <div id="showImage"></div>


                    <input name="PhotoUrl" id="PhotoUrl" value="" type="hidden">

                    <input name="InsertEditContent" id="InsertEditContent" value="1" type="checkbox">图片是否插入编辑器
                </td>
            </tr>
        </table>
    </form>
</div>
</div>
</body>
</html>