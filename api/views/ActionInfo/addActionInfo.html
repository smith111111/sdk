<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加权限</title>
    <script type="text/javascript" src="../../static/js/jquery.js"></script>
    <script type="text/javascript" src="../../static/js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/static/js/easyui-lang-zh_CN.js"></script>
    <link href="../../static/css/themes/default/easyui.css" rel="stylesheet" />
    <link href="../../static/css/themes/icon.css" rel="stylesheet" />
    <script type="text/javascript" src="../../static/js/jquery.unobtrusive-ajax.min.js" ></script>
    <script type="text/javascript" src="../../static/js/MyAjaxForm.js"></script>
    <script type="text/javascript">
        $(function () {
            bindChangeActionTypeEnum()
            bindBtnFileUp();//文件上传
        })
        function bindChangeActionTypeEnum() {
            $("#changeActionTypeEnum").change(function () {
                if ($(this).val()=="1"){
                    $('#iconTr').fadeIn()
                }else{
                    $('#iconTr').fadeOut()
                }
            })
        }

        function formActionSubmit(){
            $('#addActionform').submit()
        }
        function afterAddAction(data) {
            window.parent.closeActionDialog(data)
        }

        //绑定上传按钮的单击事件 btnFileUp
        function bindBtnFileUp() {
            $("#btnFileUp").click(function () {
                $("#addActionform").ajaxSubmit({
                    success: function (str) {
                        if (str.flag=="ok"){
                            $("#showImage").html("<img src='"+str.msg.substr(1)+"' width='50px' height='50px'>")
                            $("#hiddenMenuIcon").val(str.msg.substr(1))//注意服务端返回的内容是带“.”的

                        }else{
                            alert(str.msg)
                        }
                    },
                    error: function (error) { alert(error); },
                    url: '/Admin/ActionInfo/FileUp', /*设置post提交到的页面*/
                    type: "post", /*设置表单以post方法提交*/
                    dataType: "json" /*设置返回值类型为文本*/
                });
            })
        }
    </script>
</head>
<body>

<div id="addActionDiv">
    <form  data-ajax="true" data-ajax-method="post" data-ajax-success="afterAddAction" data-ajax-url="/Admin/ActionInfo/AddAction" id="addActionform">
        <input type="hidden" name="MenuIcon" id="hiddenMenuIcon" />
        <table style="margin-left: 90px;margin-top: 130px">
            <tr>
                <td>权限名称</td>
                <td>
                    <input type="text" name="ActionInfoName" /></td>
            </tr>
            <tr>
                <td>Url</td>
                <td>
                    <input type="text" name="Url" /></td>
            </tr>
            <tr>
                <td>请求方式</td>
                <td>
                    <select name="HttpMethod">
                        <option value="GET">GET</option>
                        <option value="POST">POST</option>
                    </select>

                </td>
            </tr>

            <tr>
                <td>权限类型</td>
                <td>
                    <select name="ActionTypeEnum" id="changeActionTypeEnum">
                        <option value="0">普通权限</option>
                        <option value="1">菜单权限</option>
                    </select>

                </td>
            </tr>

            <tr style="display:none" id="iconTr">
                <td>上传图标</td>
                <td>
                    <input type="file" name="fileUp" />
                    <input type="button" value="上传图片" id="btnFileUp" />
                    <div id="showImage"></div>

                </td>
            </tr>


            <tr>
                <td>备注</td>
                <td>
                    <input type="text" name="Remark" /></td>
            </tr>

        </table>


    </form>
</div>
</body>
</html>